# Whenever a push is made to the branch then run the job
on:
  push:
    branches:
      - gh_action

env:
  GODOT_VERSION: 3.4.4
  EXPORT_NAME: Sidescroller

jobs:
  name: HTML5
  runs-on: ubuntu-20.04
  container:
    image: barichello/godot-ci:3.3.4
  steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Setup
      run: |
        mkdir -v -p ~/.local/share/godot/templates
    - name: Web Build
      run: |
        mkdir -v -p build/web
        cd $EXPORT_NAME
        godot -v --export "HTML5" ../build/web/index.html
    - name: Upload Artifact
      uses: actions/upload-artifact@v1
      with:
        name: web
        path: build/web
    - name: Install rsync ðŸ“š
      run: |
        apt-get update && apt-get install -y rsync
    - name: Deploy to GitHub Pages ðŸš€
      uses: JamesIves/github-pages-deploy-action@releases/v4
      with:
        branch: gh-pages # The branch the action should deploy to.
        folder: build/web # The folder the action should deploy.
# - name: Upload to Itch.io
#   uses: josephbmanley/butler-publish-itchio-action@master
#   env:
#     BUTLER_CREDENTIALS: ${{ secrets.BUTLER_CREDENTIALS }}  ## havent saved BUTLER_CREDENTIALS yet
#     CHANNEL: html5
#     ITCH_GAME: Sidescroller
#     ITCH_USER: avivajpeyi
#     PACKAGE: build/html5
